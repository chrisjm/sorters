{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["export type AccessorFn<T> = ((value: T) => any)\nexport type Accessor<T> = string | string[] | AccessorFn<T>;\n\nexport enum ValueType {\n  Any = 'any',\n  String = 'string',\n  Number = 'number',\n  Date = 'date',\n}\n\nexport enum Nulls {\n  /** Treat nulls as lower than any other values. This is the default setting. */\n  Low = 'low',\n  /** Treat nulls as higher than any other values. */\n  High = 'high',\n  /** Assume there are no nullish values in the data. This may cause exceptions if you are wrong. */\n  None = 'none',\n}\n\nexport interface SortAccessorDefinition<T> {\n  /** A function that returns a value to sort on, or a string/array path into the object */\n  value: Accessor<T>;\n  /** True to sort descending */\n  descending? : boolean;\n  /** Predefine the type of data for faster sorting. Using this will likely throw an exception if the data does not match the specified type. */\n  type?: ValueType;\n  /** Sort null/undefined values as lower than others (default), higher than others, or assume there aren't any. */\n  nulls?: Nulls;\n}\n\nexport type SortAccessor<T> = SortAccessorDefinition<T> | Accessor<T>;\n\nexport type CompareFn<T> = (a: T, b: T) => number;\n\n// This is from https://github.com/angus-c/just/blob/master/packages/object-safe-get/index.js\nfunction get(obj, propsArg, defaultValue?) {\n  if (!obj) {\n    return defaultValue;\n  }\n  var props, prop;\n  if (Array.isArray(propsArg)) {\n    props = propsArg.slice(0);\n  }\n  if (typeof propsArg == 'string') {\n    props = propsArg.split('.');\n  }\n  if (typeof propsArg == 'symbol') {\n    props = [propsArg];\n  }\n  if (!Array.isArray(props)) {\n    throw new Error('props arg must be an array, a string or a symbol');\n  }\n  while (props.length) {\n    prop = props.shift();\n    if (!obj) {\n      return defaultValue;\n    }\n    obj = obj[prop];\n    if (obj === undefined) {\n      return defaultValue;\n    }\n  }\n  return obj;\n}\n\nfunction sortStrings(a: string, b: string) {\n  return a.localeCompare(b);\n}\n\nfunction sortNumbers(a: number, b: number) {\n  return a - b;\n}\n\nfunction sortDates(a: Date, b: Date) {\n  return a.valueOf() - b.valueOf();\n}\n\nfunction sortAny(a: any, b : any) {\n  if(typeof a === 'number') {\n    // Try number first since it will usually be a number.\n    return a - b;\n  } else if(typeof a === 'string') {\n    return a.localeCompare(b);\n  } else if(a instanceof Date) {\n    return a.valueOf() - b.valueOf();\n  } else {\n    return a - b;\n  }\n}\n\nconst sortFnMap = {\n  [ValueType.Date]: sortDates,\n  [ValueType.Number]: sortNumbers,\n  [ValueType.String]: sortStrings,\n};\n\nfunction nullsHigh(sortFn : CompareFn<any>)  {\n  return (a, b) => {\n    let aNull = a === null || a === undefined;\n    let bNull = b === null || b === undefined;\n    if(aNull || bNull) {\n      if(aNull && bNull) {\n        return 0;\n      } else if(aNull) {\n        return 1;\n      } else if(bNull) {\n        return -1;\n      }\n    }\n\n    return sortFn(a, b);\n  }\n}\n\nfunction nullsLow(sortFn : CompareFn<any>) {\n  return (a, b) => {\n    let aNull = a === null || a === undefined;\n    let bNull = b === null || b === undefined;\n    if(aNull || bNull) {\n      if(aNull && bNull) {\n        return 0;\n      } else if(aNull) {\n        return -1;\n      } else if(bNull) {\n        return 1;\n      }\n    }\n\n    return sortFn(a, b);\n\n  };\n}\n\nfunction createAccessor<T>(acc : Accessor<T>) {\n  if(typeof acc === 'string' || Array.isArray(acc)) {\n    return (value : T) => get(value, acc);\n  }\n\n  return acc;\n}\n\nexport function sorter<T>(...accessors : SortAccessor<T>[]) {\n  let sortFns = accessors.map((acc) => {\n    if(typeof acc === 'function' || typeof acc === 'string' || Array.isArray(acc)) {\n      acc = {\n        value: acc,\n      };\n    }\n\n    let accessor = createAccessor(acc.value);\n    let sortFn : CompareFn<any> = acc.type ? sortFnMap[acc.type] : sortAny;\n\n    if(acc.nulls === Nulls.Low || acc.nulls === undefined) {\n      sortFn = nullsLow(sortFn);\n    } else if(acc.nulls === Nulls.High) {\n      sortFn = nullsHigh(sortFn);\n    }\n\n    if(acc.descending) {\n      return (a, b) => -sortFn(accessor(a), accessor(b));\n    } else {\n      return (a, b) => sortFn(accessor(a), accessor(b));\n    }\n  });\n\n  return function sortComparator(a, b) {\n    for(let fn of sortFns) {\n      let cmpValue = fn(a, b);\n      if(cmpValue !== 0) {\n        return cmpValue;\n      }\n    }\n\n    return 0;\n  }\n}\n\nexport default sorter;\n\n"],"names":["ValueType","Nulls"],"mappings":"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"}